# Cloudflare Pages Node.js 20設定（最終版）

## 問題の状況

環境変数`NODE_VERSION=20`を設定しても、まだNode.js 18.17.0が使われている。

## 確認事項と解決策

### 1. 環境変数の設定確認

Cloudflare Pagesダッシュボードで以下を確認：

1. **設定** → **環境変数**
2. `NODE_VERSION` が **存在するか**
3. 値が **`20`** になっているか（`20.0.0`や`20.x`ではないか確認）
4. **本番環境**と**プレビュー環境**の両方にチェックが入っているか

### 2. Cloudflare Pagesのビルド設定を確認

**設定** → **ビルドとデプロイ** → **ビルド設定**で確認：

- **Node.jsバージョン**の直接指定オプションがあるか
- ビルドコマンドが正しく設定されているか

### 3. 推奨される対応（Cloudflare Pagesダッシュボードで）

もしCloudflare Pagesのダッシュボードに「Node.jsバージョン」を直接指定するオプションがあれば、そちらを使用してください。

### 4. 一時的な回避策：ビルド前チェック

`package.json`の`build`スクリプトにバージョンチェックを追加（これは環境が正しく設定されていない場合にエラーを明確にするだけ）：

現在の設定は問題ないので、環境変数の再設定を試してください。

### 5. 最も可能性の高い原因

環境変数`NODE_VERSION=20`が設定されていても、以下が考えられます：

1. **環境変数の適用タイミング**: 環境変数を設定した後、**新しいビルドを手動でトリガー**していない
2. **環境変数のスコープ**: プレビュー環境と本番環境で別々に設定する必要がある
3. **Cloudflare Pagesのキャッシュ**: 古い設定がキャッシュされている

### 6. 確実な対処手順

1. Cloudflare Pagesダッシュボード → **設定** → **環境変数**
2. `NODE_VERSION`を削除（既存の設定があれば）
3. 新しく追加：
   - 変数名: `NODE_VERSION`
   - 値: `20`（**`20`のみ、`20.0.0`や`20.x`ではない**）
   - 環境: ✅本番環境 ✅プレビュー環境
4. **保存**
5. **デプロイ**タブ → **「新しいデプロイを作成」**（またはGitHubにプッシュ）
6. ビルドログの最初の部分で以下を確認：
   ```
   ✓ Using Node.js version 20.x.x
   ```
   または
   ```
   Node.js version: 20.x.x
   ```

### 7. それでも解決しない場合

Cloudflare Pagesのサポートに問い合わせるか、以下の情報を確認：
- Cloudflare Pagesのアカウントタイプ（無料プランか有料プランか）
- プロジェクトの作成日時（古いプロジェクトの場合、設定が反映されない可能性）

