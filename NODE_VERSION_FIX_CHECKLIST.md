# Node.jsバージョン問題 チェックリスト

## 現在の状態
- ❌ まだNode.js 18.17.0が使用されている
- ✅ `.nvmrc`ファイルは`20`に設定済み
- ✅ `package.json`の`engines`フィールドに`"node": ">=20.0.0"`を追加済み
- ❓ 環境変数`NODE_VERSION=20`の設定が反映されていない可能性

## 今すぐ確認すべきこと

### 1. Cloudflare Pagesダッシュボードでの環境変数設定

**設定** → **環境変数** で以下を確認：

- [ ] `NODE_VERSION`という環境変数が存在する
- [ ] 値が **`20`** になっている（`20.0.0`や`20.x`ではない）
- [ ] **本番環境（Production）**にチェックが入っている
- [ ] **プレビュー環境（Preview）**にチェックが入っている

### 2. 環境変数の再設定手順

もし既に設定されていても、一度削除して再作成してください：

1. 既存の`NODE_VERSION`環境変数を削除
2. **変数を追加**をクリック
3. 以下を設定：
   ```
   変数名: NODE_VERSION
   値: 20
   ```
4. **本番環境**と**プレビュー環境**の両方にチェック
5. **保存**

### 3. 新しいビルドをトリガー

⚠️ **重要**: 環境変数を設定・変更した後は、**必ず新しいビルドを手動でトリガー**してください。

- **方法1**: Cloudflare Pagesダッシュボード → **「デプロイ」**タブ → **「新しいデプロイを作成」**
- **方法2**: GitHubに空のコミットをプッシュしてビルドをトリガー

### 4. ビルドログの確認

新しいビルドのログで以下を確認：

- ✅ `Using Node.js version 20.x.x` が表示される
- ❌ `You are using Node.js 18.17.0` が表示される場合は、まだ設定が反映されていない

## それでも解決しない場合

### オプション1: Cloudflare Pagesのビルド設定でNode.jsバージョンを直接指定

**設定** → **ビルドとデプロイ** → **ビルド設定**で、Node.jsバージョンを直接指定できるオプションがあるか確認してください。

### オプション2: ビルドコマンドを変更

Cloudflare Pagesのビルドコマンドを以下に変更：

```
NODE_VERSION=20 npm run build
```

ただし、この方法でも環境変数が認識されない可能性があります。

### オプション3: Cloudflareサポートに問い合わせ

以下の情報を用意してサポートに問い合わせ：
- プロジェクト名: `yukue-month`
- 問題: Node.jsバージョンが環境変数で指定できない
- エラーログ: `You are using Node.js 18.17.0. For Next.js, Node.js version "^18.18.0 || ^19.8.0 || >= 20.0.0" is required.`

